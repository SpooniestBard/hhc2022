"use strict";(self.webpackChunkhhc_2022=self.webpackChunkhhc_2022||[]).push([[870],{5090:(e,t,n)=>{n(7294)},6340:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>h});var a=n(7462),i=(n(7294),n(3905));n(5090),n(814);const o={sidebar_position:1},r="Wireshark Practice",s={unversionedId:"hhc2022/tolkien_ring/wireshark_practice",id:"hhc2022/tolkien_ring/wireshark_practice",title:"Wireshark Practice",description:"Challenge",source:"@site/docs/hhc2022/tolkien_ring/wireshark_practice.md",sourceDirName:"hhc2022/tolkien_ring",slug:"/hhc2022/tolkien_ring/wireshark_practice",permalink:"/hhc2022/docs/hhc2022/tolkien_ring/wireshark_practice",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"The Tolkien Ring",permalink:"/hhc2022/docs/hhc2022/tolkien_ring/"},next:{title:"Windows Event Logs",permalink:"/hhc2022/docs/hhc2022/tolkien_ring/windows_event_logs"}},l={},h=[{value:"Challenge",id:"challenge",level:3},{value:"Answers",id:"answers",level:3}],c={toc:h};function p(e){let{components:t,...o}=e;return(0,i.kt)("wrapper",(0,a.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"wireshark-practice"},"Wireshark Practice"),(0,i.kt)("h3",{id:"challenge"},"Challenge"),(0,i.kt)("admonition",{title:"Challenge Text",type:"info"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("em",{parentName:"p"},"Difficulty:")," \u2605\u2730\u2730\u2730\u2730"),(0,i.kt)("p",{parentName:"admonition"},"Use the Wireshark Phishing terminal in the Tolkien Ring to solve the mysteries around the suspicious PCAP. Get hints for this challenge by typing hint in the upper panel of the terminal.")),(0,i.kt)("p",null,"Our first challenge is to help a hapless elf who seems to have clicked on a malicious link in their email. We're given a very sus PCAP file called ",(0,i.kt)("inlineCode",{parentName:"p"},"suspicious.pcap")),(0,i.kt)("h3",{id:"answers"},"Answers"),(0,i.kt)("admonition",{title:"Terminal Question Prompt 1",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"There are objects in the PCAP file that can be exported by Wireshark and/or Tshark. What type of objects can be exported from this PCAP?")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Answer: ",(0,i.kt)("code",null,"HTTP")),(0,i.kt)("p",null,"Assets can be exported from Wireshark by clicking ",(0,i.kt)("inlineCode",{parentName:"p"},"File -> Export Objects")," and then selecting type of object to be exported. The only objects that can be exported from this PCAP are ",(0,i.kt)("strong",{parentName:"p"},"HTTP")," objects."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Wireshark file export process",src:n(6035).Z,width:"487",height:"580"}))),(0,i.kt)("admonition",{title:"Terminal Question Prompt 2",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"What is the file name of the largest file we can export?")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Answer: ",(0,i.kt)("code",null,"app.php")),(0,i.kt)("p",null,"Using the same method as before, we can select ",(0,i.kt)("inlineCode",{parentName:"p"},"File -> Export Objects -> HTTP")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Wireshark HTTP file export dialogue",src:n(4559).Z,width:"753",height:"227"})),(0,i.kt)("p",null,"In the dialogue that opens, we can see that the largest file is the second in this list: ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"app.php")),", coming in at 808kb.")),(0,i.kt)("admonition",{title:"Terminal Question Prompt 3",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"What is the packet number that starts that app.php file?")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Answer: ",(0,i.kt)("code",null,"687")),(0,i.kt)("p",null,"Thankfully, we can find the answer to this in the same dialogue as above. If we look at the far left column, we see that this file begins at packet number ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"687")),".")),(0,i.kt)("admonition",{title:"Terminal Question Prompt 4",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"What is the IP of the Apache server?")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Answer: ",(0,i.kt)("code",null,"192.185.57.242")),"Moving on, we\u2019re asked to find the source address of the Apache server which served this file. We can find this by clicking on the app.php line of the export dialogue (which will select packet 687 for us) and then going back to the main Wireshark window.",(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Wireshark entry for packet number 687",src:n(3814).Z,width:"976",height:"144"})),(0,i.kt)("p",null,"Looking at this image, we see a source IP address of ",(0,i.kt)("inlineCode",{parentName:"p"},"192.185.57.242")," and a destination address of ",(0,i.kt)("inlineCode",{parentName:"p"},"10.9.24.101"),", which we can note for later. Since this packet was served in response to an HTTP request, the Apache server is the IP in the source column of this packet: ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"192.185.57.242")),".")),(0,i.kt)("admonition",{title:"Terminal Question Prompt 5",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"What file is saved to the infected host?")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Answer: ",(0,i.kt)("code",null,"Ref_Sept24-2020.zip")),(0,i.kt)("p",null,"At this point, it\u2019s news to us that a file had been saved to a host at all, but thanks, terminal. Since we\u2019d been told that this started when the elf we\u2019re helping clicked a link in their email, it seems likely that the file was delivered over HTTP. Since we\u2019re already inspecting packet 687, we can right click it in the GUI and select Follow -> HTTP Stream to view the actual content(s) of app.php."),(0,i.kt)("p",null,"A quick analysis of the embedded JavaScript on this page should hopefully make more sense of what happened. The first retrieval of app.php merely sets two cookies and then reloads the page (comments are ours):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},"<script>\n    let d = -new Date().getTimezoneOffset(); // Time zone offset (from GMT) of the local time zone\n    let n = Intl.DateTimeFormat().resolvedOptions().timeZone; // Human-readable time zone name\n\n    ...\n\n    if (!get_cookie('d') && !get_cookie('n')) {\n        set_cookie('d', d, 2); // Set cookie \"d\" to the time zone offset with an expiration of 2 minutes\n        set_cookie('n', n, 2); // Set cookie \"n\" to the time zone name with an expiration of 2 minutes\n        document . location . reload(); // Reload the window to retrieve app.php again\n    }\n<\/script>\n")),(0,i.kt)("p",null,"As annotated above, the contents of the cookies ",(0,i.kt)("inlineCode",{parentName:"p"},"d")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"n")," are the target machine\u2019s time zone offset and time zone name, respectively. This information could have been used by evildoers to target North Pole residents specifically, although we don\u2019t have a way to be sure of this without looking at the PHP source code. The second load of the page contains some much more interesting snippets (here some comments are ours, but some existed in the source already):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<script>\nfunction saveAs(blob, fileName) {\nlet url = window.URL.createObjectURL(blob); // Creates a URL for the "blob" argument\n\nlet anchorElem = document.createElement(\'a\'); // Creates an "a" element in the HTML document named anchorElem\nanchorElem.style = \'display: none\'; // Sets anchorElem to not be rendered in a browser window\nanchorElem.href = url; // Sets the href of the document to the URL that was obtained earlier\nanchorElem.download = fileName; // Specifies the file name should the user click on this element\n\ndocument.body.appendChild(anchorElem);\nanchorElem.click(); // Forcibly click anchorElem, downloading the contents of "blob"\n\ndocument.body.removeChild(anchorElem); // Remove the element from the page after the file has been downloaded\n...\n}\n\n(function() {\n    let byteCharacters = ("...") // Obscenely long string of characters. This is an ASCII representation of the payload that the attacker wants us to pwn us with\n    let byteNumbers = new Array(byteCharacters.length);\nfor (let i = 0; i < byteCharacters.length; i++) { // This for loop serves to copy the encoded byteCharacters string into the byteNumbers array created previously\n    byteNumbers[i] = byteCharacters.charCodeAt(i);\n}\nlet byteArray = new Uint8Array(byteNumbers); // Here, the byteNumbers array is used to make a byte array, which is actually usable as a downloadable octet stream\n\n// now that we have the byte array, construct the blob from it\nlet blob1 = new Blob([byteArray], {type: \'application/octet-stream\'});\n\nsaveAs(blob1, \'Ref_Sept24-2020.zip\'); // Using the saveAs function defined above, the attacker saves this blob as "Ref_Sept24-2020.zip"\n})();\n<\/script>\n')),(0,i.kt)("p",null,"To put it shortly, the majority of this response\u2019s size is made up of an extremely large string named \u201cbyteCharacters\u201d. This string is converted to a byte array and then forcibly downloaded to our very sad elf\u2019s computer. In the final line, we can see that this file is downloaded as ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"Ref_Sept24-2020.zip")),".")),(0,i.kt)("admonition",{title:"Terminal Question Prompt 6",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Attackers used bad TLS certificates in this traffic. Which countries were they registered to?")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Answer: ",(0,i.kt)("code",null,"Israel, South Sudan")),(0,i.kt)("p",null,"Looking through the certificates in the resultant traffic reveals several certificates from Microsoft and Baltimore CyberTrust Root, all of which appear to be legitimate at a glance. Two certificates however are signed by the common names of ",(0,i.kt)("inlineCode",{parentName:"p"},"heardbellith.Icanwepeh.nagoya")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"psprponounst.aquarelle")," both of which looked like absolute gibberish. At this point, we decided to Google these names to make sure that wasn\u2019t due to us being uncultured Americans, but thankfully, they do seem to be gibberish in every language. The issuers of these certificates have the country codes of IL and SS, respectively, and a quick Google of these codes showed that our answer should be ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"Israel, South Sudan")),".")))}p.isMDXComponent=!0},6035:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/tr1-1-c632707270c6b8c096531f6866f1076b.png"},4559:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/tr1-2-5fc099854d7656447db934c039c8445d.png"},3814:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/tr1-3-4d20bd7b9e2ea44dced0f59a8ff71a7d.png"}}]);