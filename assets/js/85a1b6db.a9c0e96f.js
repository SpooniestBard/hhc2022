"use strict";(self.webpackChunkhhc_2022=self.webpackChunkhhc_2022||[]).push([[8],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>b});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),l=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},p=function(e){var t=l(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),u=l(r),h=a,b=u["".concat(s,".").concat(h)]||u[h]||d[h]||i;return r?n.createElement(b,o(o({ref:t},p),{},{components:r})):n.createElement(b,o({ref:t},p))}));function b(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,o=new Array(i);o[0]=h;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c[u]="string"==typeof e?e:a,o[1]=c;for(var l=2;l<i;l++)o[l]=r[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}h.displayName="MDXCreateElement"},3998:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var n=r(7462),a=(r(7294),r(3905));const i={sidebar_position:5},o="IMDS, XXE, and other Abbreviations",c={unversionedId:"hhc2022/web_ring/imds_xxe_abbreviations",id:"hhc2022/web_ring/imds_xxe_abbreviations",title:"IMDS, XXE, and other Abbreviations",description:"Background",source:"@site/docs/hhc2022/web_ring/imds_xxe_abbreviations.md",sourceDirName:"hhc2022/web_ring",slug:"/hhc2022/web_ring/imds_xxe_abbreviations",permalink:"/hhc2022/docs/hhc2022/web_ring/imds_xxe_abbreviations",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"404 FTW",permalink:"/hhc2022/docs/hhc2022/web_ring/ftw"},next:{title:"Open Boria Mine Door",permalink:"/hhc2022/docs/hhc2022/web_ring/boria_mine_door"}},s={},l=[{value:"Background",id:"background",level:3},{value:"Challenge",id:"challenge",level:3}],p={toc:l};function u(e){let{components:t,...i}=e;return(0,a.kt)("wrapper",(0,n.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"imds-xxe-and-other-abbreviations"},"IMDS, XXE, and other Abbreviations"),(0,a.kt)("h3",{id:"background"},"Background"),(0,a.kt)("p",null,"Still analyzing the suspicious PCAP, we're reaching the endgame of the attacker: exfiltrating some information from ",(0,a.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-data-retrieval.html"},"IMDS"),"."),(0,a.kt)("h3",{id:"challenge"},"Challenge"),(0,a.kt)("admonition",{title:"Question",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"The last step in this attack was to use XXE to get secret keys from the IMDS service. What URL did the attacker force the server to fetch?")),(0,a.kt)("p",null,"We know two things that should help us with this challenge:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},'The attacker used information gathered in the previous "forced browsing" attack (ie /proc directory will respond with XML related to/requested in the previous POST request). ')),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"IMDS attacks force a request to a non-routable/internal IP address that is always ",(0,a.kt)("a",{parentName:"p",href:"http://169.254.169.254/"},"http://169.254.169.254/"),"* "))),(0,a.kt)("p",null,"To solve this, we'll once again turn to the suspicious PCAP. Once we find a packet with 169.254.169.254 in data section of a POST request we can click follow stream and look at the last packet sent before AWS credentials are returned."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"IMDS exploit",src:r(3224).Z,width:"1568",height:"657"})),(0,a.kt)("p",null,"The full URL requested was ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("inlineCode",{parentName:"strong"},"http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance")),"."))}u.isMDXComponent=!0},3224:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/wr5-1-c373833df08b543bb8be30eb0f0a1874.png"}}]);