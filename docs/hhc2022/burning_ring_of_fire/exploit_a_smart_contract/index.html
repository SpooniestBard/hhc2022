<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-hhc2022/burning_ring_of_fire/exploit_a_smart_contract">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Exploit a Smart Contract | Devan and Kim</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/hhc2022/docs/hhc2022/burning_ring_of_fire/exploit_a_smart_contract/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Exploit a Smart Contract | Devan and Kim"><meta data-rh="true" name="description" content="Background"><meta data-rh="true" property="og:description" content="Background"><link data-rh="true" rel="icon" href="/hhc2022/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/hhc2022/docs/hhc2022/burning_ring_of_fire/exploit_a_smart_contract/"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/hhc2022/docs/hhc2022/burning_ring_of_fire/exploit_a_smart_contract/" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/hhc2022/docs/hhc2022/burning_ring_of_fire/exploit_a_smart_contract/" hreflang="x-default"><link rel="stylesheet" href="/hhc2022/assets/css/styles.5623cc86.css">
<link rel="preload" href="/hhc2022/assets/js/runtime~main.19bb9c91.js" as="script">
<link rel="preload" href="/hhc2022/assets/js/main.723fb6eb.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/hhc2022/"><div class="navbar__logo"><img src="/hhc2022/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/hhc2022/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Devan and Kim</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/hhc2022/docs/hhc2022/">Holiday Hack Challenge 2022</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/hhc2022/docs/hhc2022/">Holiday Hack Challenge 2022 Write-Up</a><button aria-label="Toggle the collapsible sidebar category &#x27;Holiday Hack Challenge 2022 Write-Up&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/hhc2022/docs/hhc2022/tolkien_ring/">The Tolkien Ring</a><button aria-label="Toggle the collapsible sidebar category &#x27;The Tolkien Ring&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/hhc2022/docs/hhc2022/elfen_ring/">The Elfen Ring</a><button aria-label="Toggle the collapsible sidebar category &#x27;The Elfen Ring&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/hhc2022/docs/hhc2022/web_ring/">The Web Ring</a><button aria-label="Toggle the collapsible sidebar category &#x27;The Web Ring&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/hhc2022/docs/hhc2022/cloud_ring/">The Cloud Ring</a><button aria-label="Toggle the collapsible sidebar category &#x27;The Cloud Ring&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/hhc2022/docs/hhc2022/burning_ring_of_fire/">The Burning Ring of Fire</a><button aria-label="Toggle the collapsible sidebar category &#x27;The Burning Ring of Fire&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hhc2022/docs/hhc2022/burning_ring_of_fire/buy_a_hat/">Buy a Hat</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hhc2022/docs/hhc2022/burning_ring_of_fire/blockchain_divination/">Blockchain Divination</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/hhc2022/docs/hhc2022/burning_ring_of_fire/exploit_a_smart_contract/">Exploit a Smart Contract</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hhc2022/docs/hhc2022/secrets/">Secrets</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/hhc2022/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/hhc2022/docs/hhc2022/"><span itemprop="name">Holiday Hack Challenge 2022 Write-Up</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/hhc2022/docs/hhc2022/burning_ring_of_fire/"><span itemprop="name">The Burning Ring of Fire</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Exploit a Smart Contract</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Exploit a Smart Contract</h1><h3 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a class="hash-link" href="#background" title="Direct link to heading">​</a></h3><p>A Sporc named Luigi has used the blockchain that hosts KringleCoin to develop his own very above-board NFT collection called the <a href="https://en.wikipedia.org/wiki/Bored_Ape" target="_blank" rel="noopener noreferrer">Bored Ape Yacht</a>... I mean the Bored Sporc Rowboat Society (BSRS). We absolutely need to get in before the project gets rug pulled, but unfortunately our wallet isn&#x27;t on the pre-sale list. Maybe we can find a way to trick the system.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="challenge">Challenge<a class="hash-link" href="#challenge" title="Direct link to heading">​</a></h3><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Challenge Text</div><div class="admonitionContent_S0QG"><p><em>Difficulty:</em> ★★★★★</p><p>Exploit flaws in a smart contract to buy yourself a Bored Sporc NFT. Find hints for this objective hidden throughout the tunnels.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="answer">Answer<a class="hash-link" href="#answer" title="Direct link to heading">​</a></h3><p>Using the <a href="https://prod-blockbrowser.kringle.co.in/" target="_blank" rel="noopener noreferrer">KringleCoin block chain explorer</a>, we can find the block that creates the BSRS smart contract: block 2. The function which performs the pre-sale mint seems interesting:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    function presale_mint(address to, bytes32 _root, bytes32[] memory _proof) public virtual {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bool _preSaleIsActive = preSaleIsActive;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        require(_preSaleIsActive, &quot;Presale is not currently active.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bytes32 leaf = keccak256(abi.encodePacked(to));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        require(verify(leaf, _root, _proof), &quot;You are not on our pre-sale allow list!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _mint(to, _tokenIdTracker.current());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _tokenIdTracker.increment();        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This function calls a function named <code>verify()</code> in order to determine if a recipient is allowed to mint the token. Let&#x27;s take a look at that too.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    function verify(bytes32 leaf, bytes32 _root, bytes32[] memory proof) public view returns (bool) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bytes32 computedHash = leaf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (uint i = 0; i &lt; proof.length; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          bytes32 proofElement = proof[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          if (computedHash &lt;= proofElement) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            computedHash = keccak256(abi.encodePacked(computedHash, proofElement));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            computedHash = keccak256(abi.encodePacked(proofElement, computedHash));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return computedHash == _root;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In order to really explain what is happening, it&#x27;s important to understand a data structure called a <a href="https://en.wikipedia.org/wiki/Merkle_tree" target="_blank" rel="noopener noreferrer">Merkle tree</a>. Expand the section below if you want a full primer on the subject.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Merkle Tree Primer</summary><div><div class="collapsibleContent_i85q"><p>A Merkle tree is a tree data structure where every leaf node contains a cryptographic hash (since we&#x27;re using Ethereum here, a <a href="https://deeprnd.medium.com/keccak-hashing-algorithm-sha-3-827896e49913" target="_blank" rel="noopener noreferrer">Keccak hash</a> in this case). Moving up the tree, every non-leaf node contains a cryptographic hash of the nodes below it. This process continues until we reach the very top (or bottom, for the Australians) of the tree. At this point, we will have one hash which is a combination of all of the other hashes in the tree. This is referred to as the <strong>root hash</strong>.</p><p>Given some hashing function (<code>hash()</code> in this case), a simple Merkle tree consisting of four hashes would look like the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0----------------------------------------------------0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                        Root                        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| hash(hash(hash_1 + hash_2) + hash(hash_3 + hash4)) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0----------------------------------------------------0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            |                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0-----------------------0       0-----------------------0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| hash(hash_1 + hash_2) |       | hash(hash_3 + hash_4) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0-----------------------0       0-----------------------0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |           |                  |               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0--------0   0--------0         0--------0      0--------0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| hash_1 |   | hash_2 |         | hash_3 |      | hash_4 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0--------0   0--------0         0--------0      0--------0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The advantage of a Merkle tree becomes clear if I want to prove a given hash input was part of the original list of leaf nodes. Because of the way the tree is architected, I can do this with only a small handful of values and <em>not</em> the entirety of the tree. For instance, if I want to prove that hash_3 was part of the original hashed set, then the only values I would need are <code>hash_4</code>, <code>hash(hash_1 + hash2)</code>. These two values are then known as my <strong>proof values</strong>. If I were to hash my initial value of hash_3 together with them in proper order, I should be able to perfectly recreate the root hash of the tree.</p><p>This feature is very useful as the Merkle tree grows larger, since the amount of proof values I would require only increases logarithmically with the size of the tree: as Professor Query Petabyte mentions:</p><blockquote><p>A proof containing 32 integers would be sufficient for a Merkle Tree with 4,294,967,296 leaf nodes!</p></blockquote><p>Speaking of Professor Query Petabyte, he&#x27;s provided us with an <a href="https://github.com/QPetabyte/Merkle_Trees" target="_blank" rel="noopener noreferrer">extremely helpful repository</a> that explains all of this in more detail and also has a Python script that lets us compute proof values and root of a Merkle tree out of the box. It can even give us the root and proof values of a Merkle tree with just one leaf hash! Although, we shouldn&#x27;t something that basic... right?</p><p>Another interesting quality of Merkle trees (which unfortunately makes our jobs harder here) is that the proof values provided to a user do not provide any other information about the data the tree was originally created from.</p></div></div></details><p>To put it briefly, since blockchain storage is expensive, Luigi has elected to use a Merkle Tree and distribute proof values to his Sporc buddies in order to avoid storing every possible pre-sale eligible wallet.</p><p>However, in the Query Petabyte repo I linked earlier, we&#x27;re given a somewhat incognito hint amongst the rest of the information:</p><blockquote><p>Of course, the root mustn&#x27;t be able to be altered, which is why keeping it IN the smart contract on the blockchain is what smart developers do.</p></blockquote><p>This is very true: if we were able to modify the root hash somehow, then the integrity of the entire Merkle tree would be null and void. Despite this, searching through the rest of the Solidity source code that establishes the BSRS smart contract reveals no hard coded root hash, nor any references to one somewhere else on the blockchain, even though the <code>verify()</code> function accepts it as an argument. If we attempt to buy a BSRS NFT from the terminal and analyze the web traffic, it becomes clear what&#x27;s happening: the root hash is stored and handled by the BSRS website.</p><p><img loading="lazy" src="/hhc2022/assets/images/brof3-1-3b90f940bef33ece2da665e952e65d26.png" width="2480" height="1376" class="img_ev3q"></p><p>Sticking in <code>test</code> for both the proof and wallet address on the purchase page makes us send the following request:</p><p><img loading="lazy" src="/hhc2022/assets/images/brof3-2-3d10afb647939b7a3ff39d50894c839d.png" width="2330" height="1584" class="img_ev3q"></p><p>We can pretty confidently say that this <code>Root</code> argument here is the root hash of the Merkle tree, and since we&#x27;re in control of this request, we&#x27;re in control of the validity of the entire tree! Using the Professor&#x27;s Python script, we can substitute our wallet address <code>0x9855d7CeaE9C6169e00F3CfeF9f1797269434813</code> (along with the null address so we get at least one proof value) into the program&#x27;s allow list and run it to get our root hash and proof value:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">allowlist </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;0x9855d7CeaE9C6169e00F3CfeF9f1797269434813&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;0x0000000000000000000000000000000000000000&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">devan@daedalus (/Users/devan/Merkle_Trees) $ ./merkle_tree.py </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Root: 0xdf5d48b2c2658bc30434b0027c71f692f9f10a1b0517cabc8e551fd0212679c5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Proof: [&#x27;0x5380c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312a&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, we can intercept the traffic, edit in our values (making sure to overwrite the original root value) and send it through to be told what we already know 😎</p><p><img loading="lazy" src="/hhc2022/assets/images/brof3-3-e6aa211495b98c1bee6f762ad0013d30.png" width="1286" height="252" class="img_ev3q"></p><p><img loading="lazy" src="/hhc2022/assets/images/brof3-4-666752ad02b30362ecd09b357667dd48.png" width="2458" height="690" class="img_ev3q"></p><p>Finally, we can authorize a transaction of 100 KC to the BSRS wallet address of <code>0xe8fC6f6a76BE243122E3d01A1c544F87f1264d3a</code>. Once we send the transaction through again with the <code>Validate</code> argument set to <code>false</code>, we&#x27;re now the proud owner of a BSRS NFT!</p><p><img loading="lazy" src="/hhc2022/assets/images/brof3-5-5584d8b59dc4f9c4672cada5ebd5fa3e.png" width="2442" height="444" class="img_ev3q"></p><p>Isn&#x27;t it lovely? (pls do not screenshot I will sue)</p><img loading="lazy" src="/hhc2022/assets/images/BSRS696-4eda253cff8d559cd7b33cd1c0724a2a.png" style="height:500px" class="img_ev3q"></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/hhc2022/docs/hhc2022/burning_ring_of_fire/blockchain_divination/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Blockchain Divination</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/hhc2022/docs/hhc2022/secrets/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Secrets</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#challenge" class="table-of-contents__link toc-highlight">Challenge</a></li><li><a href="#answer" class="table-of-contents__link toc-highlight">Answer</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Devan and Kim</div></div></div></footer></div>
<script src="/hhc2022/assets/js/runtime~main.19bb9c91.js"></script>
<script src="/hhc2022/assets/js/main.723fb6eb.js"></script>
</body>
</html>